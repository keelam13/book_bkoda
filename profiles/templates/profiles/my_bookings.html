{% extends 'profiles/base_profile.html' %}
{% load static %}
{% load booking_filters %}

{% block profile_content %}
<h3 class="profile-section-title">My Bookings</h3>

<!-- Upcoming Confirmed Trips Section -->
<div class="mb-5">
    <h4 class="text-primary mb-3"><i class="bi bi-calendar-check-fill mr-2"></i> Upcoming Confirmed Trips</h4>
    {% if upcoming_confirmed_bookings %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead class="thead-light">
                <tr>
                    <th>Ref</th>
                    <th>Trip Details</th>
                    <th>Date & Time</th>
                    <th>Passengers</th>
                    <th>Total Price</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in upcoming_confirmed_bookings %}
                <tr>
                    <td>{{ booking.booking_reference }}</td>
                    <td>{{ booking.trip.origin }} &rarr; {{ booking.trip.destination }}</td>
                    <td>{{ booking.trip.date|date:"F d, Y" }} at {{ booking.trip.departure_time|time:"H:i" }}</td>
                    <td>{{ booking.number_of_passengers }}</td>
                    <td>Php{{ booking.total_price|floatformat:2 }}</td>
                    <td>
                        <a href="{% url 'profiles:booking_detail' booking.id %}" class="btn btn-sm btn-info">View Details</a>
                        {# Add action buttons here, e.g., for cancelling or rescheduling #}
                        {# Example: <button type="button" class="btn btn-sm btn-warning">Reschedule</button> #}
                        {# Example: <button type="button" class="btn btn-sm btn-danger">Cancel</button> #}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-info" role="alert">
        You have no upcoming confirmed trips at the moment.
    </div>
    {% endif %}
</div>

<hr class="my-5">

<!-- All My Other Bookings Section -->
<div>
    <h4 class="text-secondary mb-3"><i class="bi bi-clock-history mr-2"></i> All My Other Bookings (Pending, Canceled, Completed, Past)</h4>
    {% if other_bookings %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered table-hover">
            <thead class="thead-light">
                <tr>
                    <th>Ref</th>
                    <th>Trip Details</th>
                    <th>Date & Time</th>
                    <th>Passengers</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Payment Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for booking in other_bookings %}
                <tr>
                    <td>{{ booking.booking_reference }}</td>
                    <td>{{ booking.trip.origin }} &rarr; {{ booking.trip.destination }}</td>
                    <td>{{ booking.trip.date|date:"F d, Y" }} at {{ booking.trip.departure_time|time:"H:i" }}</td>
                    <td>{{ booking.number_of_passengers }}</td>
                    <td>Php{{ booking.total_price|floatformat:2 }}</td>
                    <td><span class="badge badge-pill badge-{{ booking.status|lower|get_status_badge_class }}">{{ booking.get_status_display }}</span></td>
                    <td><span class="badge badge-pill badge-{{ booking.payment_status|lower|get_payment_status_badge_class }}">{{ booking.get_payment_status_display }}</span></td>
                    <td>
                        <a href="{% url 'profiles:booking_detail' booking.id %}" class="btn btn-sm btn-outline-info">View</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="alert alert-secondary" role="alert">
        No other bookings found.
    </div>
    {% endif %}
</div>

{% endblock %}